<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“±í•™ìƒ ë“œë¦¼ë¡œì§ ğŸŒŸ</title>
    <link rel="stylesheet" href="/elementary_school/static/style.css">
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸŒŸ ì´ˆë“±í•™ìƒ ë“œë¦¼ë¡œì§ ğŸŒŸ</h1>
            <p class="subtitle">ë‚˜ë§Œì˜ ê¿ˆì„ ì°¾ì•„ë³´ì•„ìš”!</p>
        </header>

        <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0ë‹¨ê³„ / 5ë‹¨ê³„</div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
        <main class="main-content">
            <!-- ì‹œì‘ í™”ë©´ -->
            <div class="start-screen" id="startScreen">
                <div class="welcome-card">
                    <div class="emoji-large">ğŸ¯</div>
                    <h2>ì•ˆë…•í•˜ì„¸ìš”!</h2>
                    <p>ì¬ë¯¸ìˆëŠ” ì§ˆë¬¸ë“¤ì„ í†µí•´<br>ì—¬ëŸ¬ë¶„ì˜ ê¿ˆì„ ì°¾ì•„ë³´ì•„ìš”!</p>
                    <button class="btn btn-primary btn-large" id="startBtn">
                        ğŸš€ ë“œë¦¼ë¡œì§ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- í•™ìƒ ì •ë³´ ì…ë ¥ í™”ë©´ -->
            <div class="student-info-screen" id="studentInfoScreen" style="display: none;">
                <div class="question-card">
                    <div class="emoji-medium">ğŸ˜Š</div>
                    <h2>ì•ˆë…•í•˜ì„¸ìš”! ë“œë¦¼ë¡œì§ì„ ì‹œì‘í•´ë³¼ê¹Œìš”?</h2>
                    <p>ì´ë¦„ê³¼ í•™ë…„ì„ ì•Œë ¤ì£¼ì„¸ìš”!</p>
                    
                    <div class="input-group">
                        <label for="studentName">ì´ë¦„</label>
                        <input type="text" id="studentName" placeholder="ì˜ˆ: ê¹€ë¯¼ìˆ˜" maxlength="10">
                    </div>
                    
                    <div class="input-group">
                        <label>í•™ë…„</label>
                        <div class="grade-options">
                            <div class="grade-option">
                                <input type="checkbox" id="grade5" name="studentGrade" value="5">
                                <label for="grade5">5í•™ë…„</label>
                            </div>
                            <div class="grade-option">
                                <input type="checkbox" id="grade6" name="studentGrade" value="6">
                                <label for="grade6">6í•™ë…„</label>
                            </div>
                        </div>
                    </div>
                    

                    
                    <button class="btn btn-primary" id="submitStudentInfo">
                        âœ¨ ë‹¤ìŒ ë‹¨ê³„ë¡œ
                    </button>
                </div>
            </div>

            <!-- ì§ˆë¬¸ í™”ë©´ -->
            <div class="question-screen" id="questionScreen" style="display: none;">
                <div class="question-card">
                    <div class="emoji-medium" id="questionEmoji">ğŸ¤”</div>
                    <h2 id="questionTitle">ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
                    <p id="questionDescription">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                    
                    <div class="choices-container" id="choicesContainer">
                        <!-- ì„ íƒì§€ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                    
                    <div class="custom-answer-container" id="customAnswerContainer" style="display: none;">
                        <label for="customAnswer">ì§ì ‘ ì…ë ¥í•˜ê¸°:</label>
                        <textarea id="customAnswer" placeholder="ììœ ë¡­ê²Œ ì¨ì£¼ì„¸ìš”!" rows="3" maxlength="200"></textarea>
                    </div>
                    
                    <div class="encouragement" id="encouragement">
                        ì •ë§ íŠ¹ë³„í•œ ìƒê°ì´ì—ìš”! ğŸŒŸ
                    </div>
                    
                    <button class="btn btn-primary" id="submitAnswer" disabled>
                        ğŸ¯ ë‹µë³€ ì œì¶œí•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- AI ì§„ë¡œ ì¶”ì²œ í™”ë©´ -->
            <div class="recommendation-screen" id="recommendationScreen" style="display: none;">
                <div class="question-card">
                    <div class="emoji-large">ğŸ¯</div>
                    <h2 id="studentNameDisplay">ê¹€ë¯¼ìˆ˜</h2>
                    <p>ì—ë“€ë¹Œì´ ì¶”ì²œí•˜ëŠ” ë“œë¦¼ë¡œì§ì„ í™•ì¸í•´ ì£¼ì„¸ìš”!</p>
                    
                    <div class="recommendation-loading" id="recommendationLoading">
                        <div class="spinner"></div>
                        <p>ë“œë¦¼ë¡œì§ì´ ì—¬ëŸ¬ë¶„ì˜ ë‹µë³€ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”... âœ¨</p>
                    </div>
                    
                    <div class="recommendation-result" id="recommendationResult" style="display: none;">
                        <div class="recommendation-card">
                            <h3>ğŸŒŸ ìµœì¢… ê¿ˆ</h3>
                            <div class="career-recommendation" id="careerRecommendation">
                                <!-- AI ì¶”ì²œ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="acceptRecommendation">
                                ğŸ‘ ì¢‹ì•„ìš”! ì´ ì§„ë¡œë¡œ í• ê²Œìš”
                            </button>
                            <button class="btn btn-secondary" id="modifyRecommendation">
                                ğŸ”„ ë‹¤ë¥¸ ì§„ë¡œë„ ë³´ê³  ì‹¶ì–´ìš”
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìµœì¢… ì™„ë£Œ í™”ë©´ -->
            <div class="completion-screen" id="completionScreen" style="display: none;">
                <div class="completion-card">
                    <div class="emoji-large">ğŸ‰</div>
                    <h2 id="completionTitle">ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
                    <p id="completionMessage">ëª¨ë“  ë‹¨ê³„ë¥¼ ì™„ë£Œí–ˆì–´ìš”! ì •ë§ ëŒ€ë‹¨í•´ìš”!</p>
                    
                    <div class="final-career" id="finalCareer">
                        <!-- ìµœì¢… í™•ì •ëœ ì§„ë¡œê°€ í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    
                    <!-- AI ì‘ì›ë©”ëª¨ í‘œì‹œ ì˜ì—­ -->
                    <div class="final-encouragement" id="finalEncouragement" style="display: none;">
                        <div class="encouragement-card">
                            <h3>ğŸ’ ë“œë¦¼ë¡œì§ì´ ë³´ë‚´ëŠ” íŠ¹ë³„í•œ ì‘ì› ë©”ì‹œì§€</h3>
                            <p id="finalEncouragementText"></p>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="generateDreamLogic">
                            ğŸŒˆ ê¿ˆ ì‹¤í˜„ ë°©ë²• ì•Œì•„ë³´ê¸°
                        </button>
                        <button class="btn btn-secondary" id="restartJourney">
                            ğŸ”„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë“œë¦¼ë¡œì§ í™”ë©´ -->
            <div class="dream-logic-screen" id="dreamLogicScreen" style="display: none;">
                <div class="question-card">
                    <div class="emoji-large">ğŸŒˆ</div>
                    <h2>ê¿ˆì„ ì´ë£¨ëŠ” ë°©ë²•</h2>
                    
                    <div class="dream-logic-loading" id="dreamLogicLoading">
                        <div class="spinner"></div>
                        <p>ê¿ˆì„ ì´ë£¨ëŠ” íŠ¹ë³„í•œ ë°©ë²•ì„ ë§Œë“¤ê³  ìˆì–´ìš”... âœ¨</p>
                    </div>
                    
                    <div class="dream-logic-result" id="dreamLogicResult" style="display: none;">
                        <div class="dream-steps" id="dreamSteps">
                            <!-- ê¿ˆ ì‹¤í˜„ ë‹¨ê³„ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        
                        <div class="encouragement-message" id="encouragementMessage">
                            <!-- ì‘ì› ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    
                    <div class="action-buttons" style="display: none;" id="dreamLogicActions">
                        <button class="btn btn-success" id="downloadDreamLogicPDF">
                            ğŸ“„ ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button class="btn btn-primary" id="finishJourney">
                            ğŸ† í™ˆí˜ì´ì§€ë¡œ ì´ë™!
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="spinner"></div>
            <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
        </div>
    </div>

    <script>
        console.log('ğŸŒŸ ì¸ë¼ì¸ JavaScript ì‹œì‘');
        
        // API ê¸°ë³¸ URL ì„¤ì • (í˜„ì¬ í˜ì´ì§€ì˜ í˜¸ìŠ¤íŠ¸ì™€ í¬íŠ¸ ì‚¬ìš©)
        const API_BASE_URL = `${window.location.protocol}//${window.location.host}/elementary_school`;
        console.log('ğŸ”— API ê¸°ë³¸ URL:', API_BASE_URL);
        
        // ì „ì—­ ë³€ìˆ˜
        let sessionId = null;
        let studentInfo = null;
        let encouragementMessage = null; // AIê°€ ìƒì„±í•œ ì‘ì›ë©”ëª¨ ì €ì¥
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ');
            
            // ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
            const startBtn = document.getElementById('startBtn');
            if (startBtn) {
                console.log('âœ… ì‹œì‘ ë²„íŠ¼ ë°œê²¬');
                startBtn.style.border = '3px solid #4CAF50';
                startBtn.onclick = function() {
                    console.log('ğŸ–±ï¸ ì‹œì‘ ë²„íŠ¼ í´ë¦­ë¨!');
                    startCareerExploration();
                };
            } else {
                console.error('âŒ ì‹œì‘ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // í•™ìƒ ì •ë³´ ì œì¶œ ë²„íŠ¼
            const submitStudentInfoBtn = document.getElementById('submitStudentInfo');
            if (submitStudentInfoBtn) {
                submitStudentInfoBtn.onclick = function() {
                    console.log('ğŸ“ í•™ìƒ ì •ë³´ ì œì¶œ ë²„íŠ¼ í´ë¦­');
                    submitStudentInfoData();
                };
            }

            // í•™ë…„ ì„ íƒ ì´ë²¤íŠ¸ ì²˜ë¦¬
            setupGradeSelection();
        });

        // í•™ë…„ ì„ íƒ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function setupGradeSelection() {
            console.log('ğŸ“ í•™ë…„ ì„ íƒ ì´ë²¤íŠ¸ ì„¤ì •');
            
            const gradeInputs = document.querySelectorAll('input[name="studentGrade"]');
            console.log('ğŸ“‹ í•™ë…„ ì²´í¬ë°•ìŠ¤ ê°œìˆ˜:', gradeInputs.length);
            
            gradeInputs.forEach(input => {
                input.addEventListener('change', function() {
                    console.log('ğŸ“ í•™ë…„ ì²´í¬ë°•ìŠ¤ í´ë¦­:', this.value, 'ì²´í¬ë¨:', this.checked);
                    
                    if (this.checked) {
                        // ë‹¤ë¥¸ ì²´í¬ë°•ìŠ¤ í•´ì œ (ë‹¨ì¼ ì„ íƒ)
                        gradeInputs.forEach(otherInput => {
                            if (otherInput !== this) {
                                otherInput.checked = false;
                                otherInput.closest('.grade-option').classList.remove('selected');
                            }
                        });
                        this.closest('.grade-option').classList.add('selected');
                        console.log('âœ… í•™ë…„ ì„ íƒ:', this.value + 'í•™ë…„');
                    } else {
                        this.closest('.grade-option').classList.remove('selected');
                        console.log('âŒ í•™ë…„ ì„ íƒ í•´ì œ');
                    }
                });
                
                // div í´ë¦­ìœ¼ë¡œë„ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸°
                const gradeOption = input.closest('.grade-option');
                gradeOption.addEventListener('click', function(e) {
                    console.log('ğŸ–±ï¸ í•™ë…„ ì˜µì…˜ div í´ë¦­');
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'LABEL') {
                        input.click();
                    }
                });
            });
        }
        
        // ì§„ë¡œ íƒìƒ‰ ì‹œì‘ í•¨ìˆ˜
        // ============================================================================
        // Step 4 AI ì´ìŠˆ ìƒì„± ì²˜ë¦¬ í•¨ìˆ˜ë“¤ (ì•ìª½ìœ¼ë¡œ ì´ë™)
        // ============================================================================
        function handleStep4AIGeneration() {
            console.log('ğŸ¤– Step 4 AI ì´ìŠˆ ìƒì„± ì²˜ë¦¬ ì‹œì‘');
            
            // ê¸°ì¡´ ì„ íƒì§€ ì»¨í…Œì´ë„ˆë¥¼ Step 4ìš©ìœ¼ë¡œ ì¬ì‚¬ìš©
            const choicesContainer = document.getElementById('choicesContainer');
            const customAnswerContainer = document.getElementById('customAnswerContainer');
            const submitAnswer = document.getElementById('submitAnswer');
            
            if (customAnswerContainer) {
                customAnswerContainer.style.display = 'none';
            }
            
            if (submitAnswer) {
                submitAnswer.style.display = 'none';
            }
            
            // ì„ íƒì§€ ì»¨í…Œì´ë„ˆì— Step 4 ë¡œë”© í‘œì‹œ
            if (choicesContainer) {
                choicesContainer.innerHTML = `
                    <div class="ai-loading" id="step4Loading">
                        <div class="loading-spinner"></div>
                        <p>ë“œë¦¼ë¡œì§ì´ ë§ì¶¤í˜• ì´ìŠˆë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”... ğŸ¤–âœ¨</p>
                    </div>
                    
                    <div class="step4-issues-list" id="step4IssuesList" style="display: none;">
                        <!-- AI ìƒì„± ì´ìŠˆë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    
                    <div class="regenerate-section" style="margin: 20px 0; text-align: center; display: none;" id="step4RegenerateSection">
                        <button type="button" id="regenerateStep4Issues" class="btn btn-secondary">
                            ğŸ”„ ë‹¤ë¥¸ ì´ìŠˆë¡œ ë‹¤ì‹œ ìƒì„± (<span id="regenerateCount">0</span>/5)
                        </button>
                    </div>
                    
                    <div class="action-buttons" id="step4SubmitSection" style="display: none;">
                        <button type="button" id="submitStep4Choice" class="btn btn-primary" disabled>
                            ğŸš€ ë‹¤ìŒ ë‹¨ê³„ë¡œ
                        </button>
                    </div>
                `;
                choicesContainer.style.display = 'block';
            }
            
            // ìë™ìœ¼ë¡œ AI ì´ìŠˆ ìƒì„± ì‹œì‘
            generateStep4AIIssues();
        }

        async function generateStep4AIIssues(regenerate = false) {
            console.log(`ğŸ¤– Step 4 ì´ìŠˆ ìƒì„± ${regenerate ? 'ì¬ìƒì„±' : 'ì²« ìƒì„±'}`);
            
            showStep4Loading();
            
            // ì¬ìƒì„± ë²„íŠ¼ê³¼ ì œì¶œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setTimeout(() => {
                const regenerateBtn = document.getElementById('regenerateStep4Issues');
                if (regenerateBtn) {
                    regenerateBtn.onclick = () => generateStep4AIIssues(true);
                }
                
                const submitBtn = document.getElementById('submitStep4Choice');
                if (submitBtn) {
                    submitBtn.onclick = () => submitStep4Choice();
                }
            }, 100);
            
            try {
                const response = await fetch(`/elementary_school/career/${sessionId}/step4-issues`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        regenerate: regenerate
                    })
                });
                
                const data = await response.json();
                console.log('ğŸ“Š Step 4 ì´ìŠˆ ìƒì„± ì‘ë‹µ:', data);
                
                if (!response.ok) {
                    throw new Error(data.detail || 'ì´ìŠˆ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                if (data.success && data.data.issues) {
                    displayStep4Issues(data.data.issues, data.data.regeneration_count, data.data.can_regenerate);
                } else {
                    throw new Error('ì´ìŠˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('âŒ Step 4 ì´ìŠˆ ìƒì„± ì˜¤ë¥˜:', error);
                showStep4Error(error.message);
            }
        }

        function showStep4Loading() {
            console.log('â³ Step 4 ë¡œë”© í‘œì‹œ');
            
            const loading = document.getElementById('step4Loading');
            const issuesList = document.getElementById('step4IssuesList');
            const regenerateSection = document.getElementById('step4RegenerateSection');
            const submitSection = document.getElementById('step4SubmitSection');
            
            if (loading) loading.style.display = 'block';
            if (issuesList) issuesList.style.display = 'none';
            if (regenerateSection) regenerateSection.style.display = 'none';
            if (submitSection) submitSection.style.display = 'none';
        }

        function displayStep4Issues(issues, regenerationCount, canRegenerate) {
            console.log('ğŸ“‹ Step 4 ì´ìŠˆ í‘œì‹œ:', issues);
            
            const loading = document.getElementById('step4Loading');
            const issuesListContainer = document.getElementById('step4IssuesList');
            const regenerateSection = document.getElementById('step4RegenerateSection');
            const regenerateBtn = document.getElementById('regenerateStep4Issues');
            const regenerateCountSpan = document.getElementById('regenerateCount');
            const submitSection = document.getElementById('step4SubmitSection');
            
            // ë¡œë”© ìˆ¨ê¸°ê¸°
            if (loading) loading.style.display = 'none';
            
            // ì´ìŠˆ ëª©ë¡ ìƒì„±
            if (issuesListContainer) {
                issuesListContainer.innerHTML = '';
                
                issues.forEach((issue, index) => {
                    const choiceDiv = document.createElement('div');
                    choiceDiv.className = 'choice-item';
                    choiceDiv.style.cursor = 'pointer';
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = 'step4Issue';
                    input.value = index + 1;
                    input.id = `step4_issue_${index + 1}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `step4_issue_${index + 1}`;
                    label.textContent = `${index + 1}. ${issue}`;
                    label.style.cursor = 'pointer';
                    
                    // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                    const handleClick = () => {
                        // ê¸°ì¡´ ì„ íƒ í•´ì œ
                        document.querySelectorAll('input[name="step4Issue"]').forEach(inp => {
                            inp.checked = false;
                            inp.parentElement.classList.remove('selected');
                        });
                        
                        // í˜„ì¬ ì„ íƒ ì„¤ì •
                        input.checked = true;
                        choiceDiv.classList.add('selected');
                        
                        // ì„ íƒ ì²˜ë¦¬
                        onStep4IssueSelect();
                    };
                    
                    input.addEventListener('change', handleClick);
                    choiceDiv.addEventListener('click', handleClick);
                    label.addEventListener('click', (e) => {
                        e.preventDefault();
                        handleClick();
                    });
                    
                    choiceDiv.appendChild(input);
                    choiceDiv.appendChild(label);
                    issuesListContainer.appendChild(choiceDiv);
                });
                
                issuesListContainer.style.display = 'block';
            }
            
            // ì¬ìƒì„± ë²„íŠ¼ ì—…ë°ì´íŠ¸
            if (regenerateSection && regenerateBtn && regenerateCountSpan) {
                regenerateCountSpan.textContent = regenerationCount;
                regenerateSection.style.display = canRegenerate ? 'block' : 'none';
                regenerateBtn.disabled = !canRegenerate;
            }
            
            // ì œì¶œ ì„¹ì…˜ í‘œì‹œ
            if (submitSection) {
                submitSection.style.display = 'block';
            }
        }

        function onStep4IssueSelect() {
            console.log('âœ… Step 4 ì´ìŠˆ ì„ íƒë¨');
            
            const submitBtn = document.getElementById('submitStep4Choice');
            const selectedRadio = document.querySelector('input[name="step4Issue"]:checked');
            
            if (submitBtn) {
                submitBtn.disabled = !selectedRadio;
            }
            
            // ì„ íƒëœ ì´ìŠˆ ì €ì¥
            if (selectedRadio) {
                window.selectedStep4Issue = parseInt(selectedRadio.value);
                console.log('ğŸ“Œ ì„ íƒëœ ì´ìŠˆ ë²ˆí˜¸:', window.selectedStep4Issue);
            }
        }

        async function submitStep4Choice() {
            console.log('ğŸ“¤ Step 4 ì„ íƒ ì œì¶œ');
            console.log('ğŸ” selectedStep4Issue:', window.selectedStep4Issue);
            console.log('ğŸ” sessionId:', sessionId);
            console.log('ğŸ” studentInfo:', studentInfo);
            
            if (!window.selectedStep4Issue) {
                showError('ì´ìŠˆë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!sessionId) {
                showError('ì„¸ì…˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const requestBody = {
                    session_id: sessionId,
                    student_info: studentInfo,
                    response: {
                        choice_numbers: [window.selectedStep4Issue],
                        custom_answer: null
                    }
                };
                
                console.log('ğŸ“‹ ìš”ì²­ ë°ì´í„°:', requestBody);
                
                const response = await fetch(`/elementary_school/career/${sessionId}/step4-submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('ğŸ“¡ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                const data = await response.json();
                console.log('ğŸ“Š Step 4 ì œì¶œ ì‘ë‹µ:', data);
                
                if (!response.ok) {
                    throw new Error(data.detail || data.message || 'Step 4 ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                if (data.success) {
                    console.log('âœ… Step 4 ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ');
                    
                    // Step 4 ì™„ë£Œ í›„ ë°”ë¡œ AI ì§„ë¡œ ì¶”ì²œ ìš”ì²­
                    console.log('ğŸ‰ Step 4 ì™„ë£Œ, AI ì§„ë¡œ ì¶”ì²œ ìš”ì²­');
                    await requestAIRecommendation();
                } else {
                    throw new Error(data.message || 'Step 4 ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('âŒ Step 4 ì œì¶œ ì˜¤ë¥˜:', error);
                showError(`Step 4 ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        // ë‹¤ìŒ ì§ˆë¬¸ ìš”ì²­ í•¨ìˆ˜ ì¶”ê°€
        async function requestNextQuestion() {
            try {
                const response = await fetch(`/elementary_school/career/${sessionId}/question`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    showQuestionScreen(data.data);
                } else {
                    console.log('ğŸ‰ ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ!');
                    // ì™„ë£Œ í™”ë©´ í‘œì‹œ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
                }
            } catch (error) {
                console.error('âŒ ë‹¤ìŒ ì§ˆë¬¸ ìš”ì²­ ì˜¤ë¥˜:', error);
            }
        }

        function showStep4Error(message) {
            console.log('âŒ Step 4 ì˜¤ë¥˜ í‘œì‹œ:', message);
            
            const loading = document.getElementById('step4Loading');
            const issues = document.getElementById('step4Issues');
            const error = document.getElementById('step4Error');
            
            if (loading) loading.style.display = 'none';
            if (issues) issues.style.display = 'none';
            if (error) {
                error.style.display = 'block';
                const errorMessage = error.querySelector('.error-message');
                if (errorMessage) {
                    errorMessage.textContent = message;
                }
            }
        }

        async function startCareerExploration() {
            console.log('ğŸš€ ì§„ë¡œ íƒìƒ‰ ì‹œì‘');
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE_URL}/career/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                console.log('ğŸ“¡ API ì‘ë‹µ:', data);
                
                if (data.success) {
                    sessionId = data.data.session_id;
                    console.log('âœ… ì„¸ì…˜ ID ì €ì¥:', sessionId);
                    showScreen('studentInfoScreen');
                    updateProgress(0);
                } else {
                    showError('ì„¸ì…˜ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // í•™ìƒ ì •ë³´ ì œì¶œ í•¨ìˆ˜
        async function submitStudentInfoData() {
            console.log('ğŸ“ í•™ìƒ ì •ë³´ ì œì¶œ ì‹œì‘');
            
            // ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const name = document.getElementById('studentName')?.value.trim();
            console.log('ğŸ“ ì…ë ¥ëœ ì´ë¦„:', name);
            
            // ì„ íƒëœ í•™ë…„ ê°€ì ¸ì˜¤ê¸°
            const selectedGrade = document.querySelector('input[name="studentGrade"]:checked');
            const grade = selectedGrade ? parseInt(selectedGrade.value) : null;
            console.log('ğŸ“ ì„ íƒëœ í•™ë…„:', grade);

            if (!name || !grade) {
                console.error('âŒ í•„ìˆ˜ ì •ë³´ ëˆ„ë½ - ì´ë¦„:', name, 'í•™ë…„:', grade);
                showError('ì´ë¦„ê³¼ í•™ë…„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // í•™ìƒ ì •ë³´ ê°ì²´ ìƒì„± (age, school í”„ë¡œí¼í‹° ì œê±°)
            studentInfo = { name, grade };
            console.log('ğŸ“ ìµœì¢… í•™ìƒ ì •ë³´:', studentInfo);

            try {
                showLoading(true);
                console.log('ğŸŒ ì„œë²„ ì—°ê²° ì‹œë„ ì¤‘...');

                const requestBody = {
                    session_id: sessionId,
                    student_info: studentInfo,
                    response: {
                        choice_numbers: [],
                        custom_answer: `ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ${name}ì´ê³  ${grade}í•™ë…„ì´ì—ìš”.`
                    }
                };
                console.log('ğŸ“¤ ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„°:', requestBody);

                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('ğŸ“¡ ì„œë²„ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                console.log('ğŸ“¡ í•™ìƒì •ë³´ ì œì¶œ ì‘ë‹µ:', data);
                console.log('âœ… ì„œë²„ ì—°ê²° ì„±ê³µ!');
                
                if (data.success) {
                    console.log('ğŸ‰ í•™ìƒ ì •ë³´ ì„œë²„ ì €ì¥ ì„±ê³µ!');
                    console.log('ğŸ“‹ ì„œë²„ì— ì €ì¥ëœ ì •ë³´ í™•ì¸:');
                    console.log('  - ì´ë¦„:', studentInfo.name);
                    console.log('  - í•™ë…„:', studentInfo.grade);
                    
                    if (data.data && data.data.next_question) {
                        console.log('ğŸ“ ë‹¤ìŒ ì§ˆë¬¸ ë°ì´í„° ìˆ˜ì‹ :', data.data.next_question);
                        console.log('ğŸ”„ 1ë‹¨ê³„ ì§ˆë¬¸ í™”ë©´ìœ¼ë¡œ ì´ë™ ì¤‘...');
                        showQuestionScreen(data.data.next_question);
                    } else {
                        console.warn('âš ï¸ ë‹¤ìŒ ì§ˆë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', data.data);
                        showError('ë‹¤ìŒ ë‹¨ê³„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    console.error('âŒ ì„œë²„ ì €ì¥ ì‹¤íŒ¨:', data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                    showError('í•™ìƒ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.message || ''));
                }
            } catch (error) {
                console.error('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function showScreen(screenId) {
            console.log('ğŸ–¼ï¸ í™”ë©´ ì „í™˜:', screenId);
            
            const screens = [
                'startScreen', 'studentInfoScreen', 'questionScreen', 
                'recommendationScreen', 'completionScreen', 'dreamLogicScreen'
            ];
            
            screens.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.style.display = 'block';
            }
            
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) {
                progressContainer.style.display = screenId !== 'startScreen' ? 'block' : 'none';
            }
        }
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateProgress(stage, completed = false) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (!progressFill || !progressText) return;
            
            let percentage;
            let text;
            
            if (completed) {
                percentage = 100;
                text = 'ì™„ë£Œ! ğŸ‰';
            } else {
                percentage = (stage / 5) * 100;
                text = `${stage}ë‹¨ê³„ / 5ë‹¨ê³„`;
            }
            
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = text;
        }
        
        // ë¡œë”© í‘œì‹œ í•¨ìˆ˜
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = show ? 'flex' : 'none';
            }
        }
        
        // í˜„ì¬ ì§ˆë¬¸ ë°ì´í„° ì €ì¥
        let currentQuestionData = null;
        let selectedChoices = [];
        
        // í˜„ì¬ ë‹¨ê³„ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function getCurrentStage() {
            if (currentQuestionData && currentQuestionData.stage) {
                return parseInt(currentQuestionData.stage.replace('step_', ''));
            }
            return 1; // ê¸°ë³¸ê°’
        }
        
        // ë‹¨ê³„ë³„ ì œëª© ë§¤í•‘ (models.pyì˜ STAGE_QUESTIONS ë‚´ìš© ì°¸ì¡°)
        function getStageTitle(stageNumber) {
            const stageTitles = {
                0: "ì•ˆë…•í•˜ì„¸ìš”! ì§„ë¡œ íƒìƒ‰ì„ ì‹œì‘í•´ë³¼ê¹Œìš”? ì´ë¦„ê³¼ ë‚˜ì´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!",
                1: "ë¬´ì—‡ì„ í•  ë•Œ ì‹œê°„ì´ ë¹¨ë¦¬ ê°€ë‚˜ìš”? (ìµœëŒ€ 2ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥)",
                2: "ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ìë‘ í• ë§Œí•œ ë‚˜ë§Œì˜ ì¥ì ì´ ë¬´ì—‡ì¸ê°€ìš”? (ìµœëŒ€ 2ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥)", 
                3: "ì–´ë–¤ ì¼ì„ í•  ë•Œ í–‰ë³µí•¨ì„ ëŠë¼ë‚˜ìš”? (1ê°œë§Œ ì„ íƒ)",
                4: "ë¯¸ë˜ ì‚¬íšŒì—ì„œ ê°€ì¥ ê±±ì •ë˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”? (1ê°œë§Œ ì„ íƒ)",
                5: "ì—ë“€ë¹Œì´ ì¶”ì²œí•˜ëŠ” ë“œë¦¼ë¡œì§ì„ í™•ì¸í•´ ì£¼ì„¸ìš”!"
            };
            return stageTitles[stageNumber] || "ì§ˆë¬¸";
        }
        
        // ì§ˆë¬¸ í™”ë©´ í‘œì‹œ í•¨ìˆ˜
        function showQuestionScreen(questionData) {
            console.log('ğŸ“‹ ì§ˆë¬¸ í™”ë©´ í‘œì‹œ:', questionData);
            currentQuestionData = questionData;
            selectedChoices = [];
            
            // ì§ˆë¬¸ í™”ë©´ìœ¼ë¡œ ì „í™˜
            showScreen('questionScreen');
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (í˜„ì¬ ë‹¨ê³„)
            updateProgress(questionData.stage || 1);
            
            // ì§ˆë¬¸ ë‚´ìš© ì—…ë°ì´íŠ¸
            const questionTitle = document.getElementById('questionTitle');
            const questionContent = document.getElementById('questionDescription');
            const choicesContainer = document.getElementById('choicesContainer');
            
            // stage ê°’ì—ì„œ ìˆ«ì ì¶”ì¶œ
            const stageNumber = questionData.stage ? parseInt(questionData.stage.replace('step_', '')) : 1;
            const stageQuestion = getStageTitle(stageNumber);
            
            if (questionTitle) {
                questionTitle.textContent = `${stageNumber}ë‹¨ê³„`;
            }
            
            if (questionContent) {
                // models.pyì˜ question ë‚´ìš©ì„ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ API ì‘ë‹µ ì‚¬ìš©
                console.log('ğŸ” Stage Question:', stageQuestion);
                console.log('ğŸ” API Question:', questionData.question);
                console.log('ğŸ” Question Data ì „ì²´:', questionData);
                
                const finalQuestion = stageQuestion || questionData.question || '';
                console.log('ğŸ” ìµœì¢… ì§ˆë¬¸:', finalQuestion);
                questionContent.textContent = finalQuestion;
            }
            
            // ì„ íƒì§€ ë Œë”ë§ (ì²´í¬ë°•ìŠ¤/ë¼ë””ì˜¤ ë²„íŠ¼ í˜•íƒœ)
            // Step 4ì¸ ê²½ìš° AI ì´ìŠˆ ìƒì„±ìœ¼ë¡œ ì²˜ë¦¬
            
            console.log('ğŸ” Stage:', questionData.stage, 'Number:', stageNumber);
            console.log('ğŸ” Step 4 ì²´í¬:', questionData.stage === 'step_4');
            console.log('ğŸ” Step 5 ì²´í¬:', questionData.stage === 'step_5');
            console.log('ğŸ” Choices:', questionData.choices);
            
            if (questionData.stage === 'step_4') {
                console.log('ğŸš€ Step 4 ê°ì§€! AI ì´ìŠˆ ìƒì„± ì²˜ë¦¬');
                // Step 4ëŠ” AI ì´ìŠˆ ìƒì„±ìœ¼ë¡œ ì²˜ë¦¬
                handleStep4AIGeneration();
                return;
            }
            
            if (questionData.stage === 'step_5') {
                console.log('ğŸš€ Step 5 ê°ì§€! AI ì§„ë¡œ ì¶”ì²œ ì²˜ë¦¬');
                // Step 5ëŠ” AI ì§„ë¡œ ì¶”ì²œìœ¼ë¡œ ì²˜ë¦¬
                requestAIRecommendation();
                return;
            }
            
            if (choicesContainer && questionData.choices) {
                choicesContainer.innerHTML = '';
                const isMultipleChoice = stageNumber <= 2; // 1-2ë‹¨ê³„ëŠ” ë‹¤ì¤‘ì„ íƒ, 3-4ë‹¨ê³„ëŠ” ë‹¨ì¼ì„ íƒ
                console.log('ğŸ” Multiple:', isMultipleChoice);
                
                questionData.choices.forEach((choice, index) => {
                    const choiceDiv = document.createElement('div');
                    choiceDiv.className = 'choice-item';
                    choiceDiv.style.cursor = 'pointer';
                    
                    const input = document.createElement('input');
                    input.type = isMultipleChoice ? 'checkbox' : 'radio';
                    input.name = 'choice';
                    input.value = index + 1;
                    input.id = `choice${index + 1}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `choice${index + 1}`;
                    label.textContent = choice;
                    label.style.cursor = 'pointer';
                    
                    // "ê¸°íƒ€" í•­ëª©ì¸ì§€ í™•ì¸
                    const isOtherOption = choice.includes('ê¸°íƒ€') || choice === 'ê¸°íƒ€';
                    
                    // ì „ì²´ div í´ë¦­ìœ¼ë¡œë„ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„ 
                    const handleClick = () => {
                        console.log('ğŸ”¥ ì„ íƒì§€ í´ë¦­:', choice, 'í˜„ì¬ ì²´í¬ ìƒíƒœ:', input.checked);
                        
                        const currentStage = getCurrentStage();
                        
                        if (isOtherOption) {
                            // ê¸°íƒ€ í•­ëª©ì„ í´ë¦­í•œ ê²½ìš°
                            if (!input.checked) {
                                // ê¸°íƒ€ë¥¼ ì„ íƒí•˜ë ¤ëŠ” ê²½ìš° - 1~4ë‹¨ê³„ì—ì„œ ë‹¤ë¥¸ ëª¨ë“  ì„ íƒ í•´ì œ
                                if (currentStage <= 4) {
                                    document.querySelectorAll('input[name="choice"]').forEach(inp => {
                                        if (inp !== input) {
                                            inp.checked = false;
                                        }
                                    });
                                }
                                input.checked = true;
                                handleOtherSelection(input, currentStage);
                            } else {
                                // ê¸°íƒ€ë¥¼ í•´ì œí•˜ë ¤ëŠ” ê²½ìš°
                                input.checked = false;
                                handleOtherSelection(input, currentStage);
                            }
                        } else {
                            // ì¼ë°˜ í•­ëª©ì„ í´ë¦­í•œ ê²½ìš°
                            if (!input.checked) {
                                // ì¼ë°˜ í•­ëª©ì„ ì„ íƒí•˜ë ¤ëŠ” ê²½ìš°
                                if (isMultipleChoice) {
                                    // ë‹¤ì¤‘ ì„ íƒì—ì„œ 2ê°œ ì œí•œ ì²´í¬ (ê¸°íƒ€ ì œì™¸)
                                    const checkedInputs = document.querySelectorAll('input[name="choice"]:checked');
                                    const nonOtherChecked = Array.from(checkedInputs).filter(inp => {
                                        const label = document.querySelector(`label[for="${inp.id}"]`);
                                        return label && !(label.textContent.includes('ê¸°íƒ€') || label.textContent === 'ê¸°íƒ€');
                                    });
                                    if (nonOtherChecked.length >= 2) {
                                        showError('ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                                        return;
                                    }
                                } else {
                                    // ë¼ë””ì˜¤ ë²„íŠ¼ì˜ ê²½ìš° ë‹¤ë¥¸ ëª¨ë“  ì„ íƒ í•´ì œ
                                    document.querySelectorAll('input[name="choice"]').forEach(inp => {
                                        inp.checked = false;
                                    });
                                }
                                
                                // 1~4ë‹¨ê³„ì—ì„œ ì¼ë°˜ í•­ëª© ì„ íƒ ì‹œ ê¸°íƒ€ í•­ëª© í•´ì œ
                                if (currentStage <= 4) {
                                    document.querySelectorAll('input[name="choice"]').forEach(inp => {
                                        const label = document.querySelector(`label[for="${inp.id}"]`);
                                        const isOther = label && (label.textContent.includes('ê¸°íƒ€') || label.textContent === 'ê¸°íƒ€');
                                        if (isOther) {
                                            inp.checked = false;
                                        }
                                    });
                                }
                                
                                input.checked = true;
                            } else {
                                // ì¼ë°˜ í•­ëª©ì„ í•´ì œí•˜ë ¤ëŠ” ê²½ìš°
                                input.checked = false;
                            }
                            updateSelectedChoices(input);
                        }
                        
                        console.log('ğŸ”„ ì²˜ë¦¬ í›„ ìƒíƒœ:', input.checked);
                    };
                    
                    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                    choiceDiv.addEventListener('click', handleClick);
                    input.addEventListener('click', (e) => e.stopPropagation()); // ì¤‘ë³µ í´ë¦­ ë°©ì§€
                    label.addEventListener('click', (e) => e.stopPropagation()); // ì¤‘ë³µ í´ë¦­ ë°©ì§€
                    
                    choiceDiv.appendChild(input);
                    choiceDiv.appendChild(label);
                    choicesContainer.appendChild(choiceDiv);
                });
            }
            
            // ì»¤ìŠ¤í…€ ì…ë ¥ì°½ ì´ˆê¸°í™”
            const customAnswerContainer = document.getElementById('customAnswerContainer');
            const customAnswerInput = document.getElementById('customAnswer');
            if (customAnswerContainer) {
                customAnswerContainer.style.display = 'none';
            }
            if (customAnswerInput) {
                customAnswerInput.value = '';
            }
            
            // ì œì¶œ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const submitButton = document.getElementById('submitAnswer');
            if (submitButton) {
                submitButton.textContent = 'ğŸš€ ë‹¤ìŒ ë‹¨ê³„ë¡œ';
                submitButton.disabled = true;
                submitButton.onclick = () => submitCurrentAnswer();
            }
        }
        
        // "ê¸°íƒ€" ì„ íƒ ì²˜ë¦¬ í•¨ìˆ˜
        function handleOtherSelection(clickedInput, stageNumber) {
            console.log('ğŸ“ ê¸°íƒ€ ì„ íƒ ì²˜ë¦¬:', clickedInput.value, 'Stage:', stageNumber, 'Checked:', clickedInput.checked);
            
            const customAnswerContainer = document.getElementById('customAnswerContainer');
            const customAnswerInput = document.getElementById('customAnswer');
            
            if (clickedInput.checked) {
                // ê¸°íƒ€ ì„ íƒ ì‹œ
                // ì»¤ìŠ¤í…€ ì…ë ¥ì°½ í‘œì‹œ
                if (customAnswerContainer) {
                    customAnswerContainer.style.display = 'block';
                }
                if (customAnswerInput) {
                    customAnswerInput.focus();
                    // ì…ë ¥ ì‹œ ì œì¶œ ë²„íŠ¼ í™œì„±í™”
                    customAnswerInput.oninput = () => updateSubmitButton();
                }
            } else {
                // ê¸°íƒ€ ì„ íƒ í•´ì œ ì‹œ
                if (customAnswerContainer) {
                    customAnswerContainer.style.display = 'none';
                }
                if (customAnswerInput) {
                    customAnswerInput.value = '';
                }
            }
            
            // í˜„ì¬ ì²´í¬ëœ ëª¨ë“  í•­ëª©ì„ ê¸°ë°˜ìœ¼ë¡œ selectedChoices ì—…ë°ì´íŠ¸
            updateSelectedChoices();
        }
        
        // ì œì¶œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSubmitButton() {
            const submitButton = document.getElementById('submitAnswer');
            const customAnswerInput = document.getElementById('customAnswer');
            const customAnswerContainer = document.getElementById('customAnswerContainer');
            
            console.log('ğŸ”„ updateSubmitButton í˜¸ì¶œë¨');
            console.log('ğŸ“‹ í˜„ì¬ selectedChoices:', selectedChoices);
            
            if (submitButton) {
                let canSubmit = false;
                
                if (customAnswerContainer && customAnswerContainer.style.display !== 'none') {
                    // ì»¤ìŠ¤í…€ ì…ë ¥ì´ í™œì„±í™”ëœ ê²½ìš°
                    const customValue = customAnswerInput ? customAnswerInput.value.trim() : '';
                    canSubmit = customValue.length > 0;
                    console.log('ğŸ“ ì»¤ìŠ¤í…€ ì…ë ¥ ëª¨ë“œ, ì…ë ¥ê°’:', customValue, 'ì œì¶œ ê°€ëŠ¥:', canSubmit);
                } else {
                    // ì¼ë°˜ ì„ íƒì§€ì˜ ê²½ìš°
                    canSubmit = selectedChoices.length > 0;
                    console.log('âœ… ì¼ë°˜ ì„ íƒ ëª¨ë“œ, ì„ íƒëœ ê°œìˆ˜:', selectedChoices.length, 'ì œì¶œ ê°€ëŠ¥:', canSubmit);
                }
                
                submitButton.disabled = !canSubmit;
                console.log('ğŸ”˜ ì œì¶œ ë²„íŠ¼ ìƒíƒœ:', canSubmit ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”');
            }
        }
        
        // ì„ íƒëœ ì„ íƒì§€ ì—…ë°ì´íŠ¸
        function updateSelectedChoices(clickedInput = null) {
            console.log('ğŸ”„ updateSelectedChoices í˜¸ì¶œë¨');
            
            // í˜„ì¬ ì²´í¬ëœ ëª¨ë“  input ìš”ì†Œ ì°¾ê¸°
            const checkedInputs = document.querySelectorAll('input[name="choice"]:checked');
            console.log('ğŸ” ì²´í¬ëœ input ìš”ì†Œë“¤:', checkedInputs.length, 'ê°œ');
            
            // ì„ íƒëœ ê°’ë“¤ ë°°ì—´ë¡œ ì €ì¥
            selectedChoices = Array.from(checkedInputs).map(input => parseInt(input.value));
            console.log('ğŸ“‹ ì„ íƒëœ ì„ íƒì§€ ë²ˆí˜¸ë“¤:', selectedChoices);
            
            // ëª¨ë“  choice-itemì— ëŒ€í•´ ì„ íƒ ìƒíƒœ ì‹œê°ì  í‘œì‹œ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.choice-item').forEach((choiceDiv, index) => {
                const input = choiceDiv.querySelector('input');
                if (input && input.checked) {
                    choiceDiv.classList.add('selected');
                    console.log(`âœ… ì„ íƒì§€ ${index + 1} ì„ íƒë¨`);
                } else {
                    choiceDiv.classList.remove('selected');
                }
            });
            
            // ì¼ë°˜ ì„ íƒì§€ ì„ íƒ ì‹œ ì»¤ìŠ¤í…€ ì…ë ¥ì°½ ìˆ¨ê¸°ê¸° ë° ì´ˆê¸°í™”
            const customAnswerContainer = document.getElementById('customAnswerContainer');
            const customAnswerInput = document.getElementById('customAnswer');
            
            // ê¸°íƒ€ê°€ ì„ íƒë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const otherInputChecked = Array.from(checkedInputs).some(input => {
                const label = document.querySelector(`label[for="${input.id}"]`);
                return label && (label.textContent.includes('ê¸°íƒ€') || label.textContent === 'ê¸°íƒ€');
            });
            
            if (customAnswerContainer) {
                if (otherInputChecked) {
                    // ê¸°íƒ€ê°€ ì„ íƒëœ ê²½ìš° ì»¤ìŠ¤í…€ ì…ë ¥ì°½ í‘œì‹œ
                    customAnswerContainer.style.display = 'block';
                } else {
                    // ê¸°íƒ€ê°€ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ì»¤ìŠ¤í…€ ì…ë ¥ì°½ ìˆ¨ê¸°ê³  ê°’ ì´ˆê¸°í™”
                    customAnswerContainer.style.display = 'none';
                    if (customAnswerInput) {
                        customAnswerInput.value = '';
                    }
                }
            }
            
            updateSubmitButton();
            console.log('ì„ íƒëœ í•­ëª©ë“¤:', selectedChoices);
        }
        
        // í˜„ì¬ ë‹µë³€ ì œì¶œ í•¨ìˆ˜
        async function submitCurrentAnswer() {
            if (selectedChoices.length === 0) {
                showError('ì„ íƒì§€ë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê¸°íƒ€ í•­ëª©ì´ ì‹¤ì œë¡œ ì„ íƒë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const checkedInputs = document.querySelectorAll('input[name="choice"]:checked');
            const otherInputSelected = Array.from(checkedInputs).some(input => {
                const label = document.querySelector(`label[for="${input.id}"]`);
                return label && (label.textContent.includes('ê¸°íƒ€') || label.textContent === 'ê¸°íƒ€');
            });
            
            // ì»¤ìŠ¤í…€ ì…ë ¥ ì²˜ë¦¬
            const customAnswerContainer = document.getElementById('customAnswerContainer');
            const customAnswerInput = document.getElementById('customAnswer');
            let customAnswer = "";
            
            // ê¸°íƒ€ê°€ ì‹¤ì œë¡œ ì„ íƒëœ ê²½ìš°ì—ë§Œ ì»¤ìŠ¤í…€ ì…ë ¥ê°’ ì²˜ë¦¬
            if (otherInputSelected && customAnswerContainer && customAnswerContainer.style.display !== 'none' && customAnswerInput) {
                customAnswer = customAnswerInput.value.trim();
                if (!customAnswer) {
                    showError('ê¸°íƒ€ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else {
                // ê¸°íƒ€ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì»¤ìŠ¤í…€ ë‹µë³€ì€ ë¹ˆ ë¬¸ìì—´ë¡œ ì„¤ì •
                customAnswer = "";
            }
            
            console.log('âœ… ì„ íƒ ì œì¶œ:', selectedChoices);
            console.log('âœ… ì»¤ìŠ¤í…€ ë‹µë³€:', customAnswer);
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        student_info: studentInfo,
                        response: {
                            choice_numbers: selectedChoices,
                            custom_answer: customAnswer
                        }
                    })
                });
                
                const data = await response.json();
                console.log('ğŸ“¡ ì„ íƒ ì‘ë‹µ:', data);
                
                if (data.success) {
                    if (data.data.next_question) {
                        // 5ë‹¨ê³„ì¸ ê²½ìš° AI ì¶”ì²œ ìš”ì²­
                        const nextStage = data.data.next_question.stage;
                        if (nextStage === 'step_5') {
                            await requestAIRecommendation();
                        } else {
                            // ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™
                            showQuestionScreen(data.data.next_question);
                        }
                    } else if (data.data.recommendation) {
                        // ì¶”ì²œ ê²°ê³¼ í‘œì‹œ
                        showRecommendationScreen(data.data.recommendation || data.data);
                    } else {
                        // ì™„ë£Œ í™”ë©´
                        showScreen('completionScreen');
                        updateProgress(5, true);
                    }
                } else {
                    showError('ì‘ë‹µ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ì¶”ì²œ ê²°ê³¼ í™”ë©´ í‘œì‹œ í•¨ìˆ˜
        function showRecommendationScreen(recommendation) {
            console.log('ğŸ¯ ì¶”ì²œ ê²°ê³¼ í‘œì‹œ:', recommendation);
            showScreen('recommendationScreen');
            updateProgress(5, true);
            
            // í•™ìƒ ì´ë¦„ í‘œì‹œ
            const studentNameDisplay = document.getElementById('studentNameDisplay');
            if (studentNameDisplay && studentInfo) {
                studentNameDisplay.textContent = `${studentInfo.name}ë‹˜`;
            }
            
            // ë¡œë”© í‘œì‹œ
            const recommendationLoading = document.getElementById('recommendationLoading');
            const recommendationResult = document.getElementById('recommendationResult');
            
            if (recommendationLoading) {
                recommendationLoading.style.display = 'block';
            }
            if (recommendationResult) {
                recommendationResult.style.display = 'none';
            }
            
            // ì‹¤ì œ LLM ì¶”ì²œ ê²°ê³¼ê°€ ìˆìœ¼ë©´ í‘œì‹œ
            setTimeout(() => {
                if (recommendationLoading) {
                    recommendationLoading.style.display = 'none';
                }
                if (recommendationResult) {
                    recommendationResult.style.display = 'block';
                }
                
                const careerRecommendation = document.getElementById('careerRecommendation');
                if (careerRecommendation) {
                    let recommendationText = '';
                    
                    if (recommendation && recommendation.career_recommendations) {
                        recommendationText = recommendation.career_recommendations;
                    } else if (recommendation && recommendation.content) {
                        recommendationText = recommendation.content;
                    } else if (recommendation && typeof recommendation === 'string') {
                        recommendationText = recommendation;
                    } else {
                        recommendationText = `
                            <div class="career-item">
                                <h4>ğŸ¨ ì˜ˆìˆ  ë¶„ì•¼</h4>
                                <p>${studentInfo.name}ë‹˜ì˜ ì°½ì˜ì ì¸ ë‹µë³€ì„ ë³´ë‹ˆ ì˜ˆìˆ  ë¶„ì•¼ì— ì¬ëŠ¥ì´ ìˆì–´ ë³´ì—¬ìš”!</p>
                            </div>
                            <div class="career-item">
                                <h4>ğŸ”¬ ê³¼í•™ ë¶„ì•¼</h4>
                                <p>í˜¸ê¸°ì‹¬ì´ ë§ê³  íƒêµ¬ì‹¬ì´ ê°•í•œ ${studentInfo.name}ë‹˜ê»˜ ì¶”ì²œë“œë ¤ìš”!</p>
                            </div>
                        `;
                    }
                    
                    careerRecommendation.innerHTML = recommendationText;
                }
                
                // ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
                const acceptButton = document.getElementById('acceptRecommendation');
                const modifyButton = document.getElementById('modifyRecommendation');
                
                if (acceptButton) {
                    acceptButton.onclick = () => acceptCareerRecommendation();
                }
                
                if (modifyButton) {
                    modifyButton.onclick = () => requestNewRecommendation();
                }
            }, 2000); // 2ì´ˆ í›„ ê²°ê³¼ í‘œì‹œ
        }
        
        // AI ì¶”ì²œ ìš”ì²­ í•¨ìˆ˜
        async function requestAIRecommendation() {
            console.log('ğŸ¤– AI ì§„ë¡œ ì¶”ì²œ ìš”ì²­');
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/recommend`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                console.log('ğŸ¤– AI ì¶”ì²œ ì‘ë‹µ:', data);
                
                if (data.success && data.data.career_recommendation) {
                    // AI ì¶”ì²œ ê²°ê³¼ë¡œ ì¶”ì²œ í™”ë©´ í‘œì‹œ
                    showRecommendationScreen({
                        career_recommendations: data.data.career_recommendation,
                        stage: 5
                    });
                } else {
                    showError('AI ì§„ë¡œ ì¶”ì²œì„ ë°›ì•„ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ AI ì¶”ì²œ ì˜¤ë¥˜:', error);
                showError('AI ì§„ë¡œ ì¶”ì²œ ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ìƒˆë¡œìš´ ì§„ë¡œ ì¶”ì²œ ìš”ì²­ í•¨ìˆ˜
        async function requestNewRecommendation() {
            console.log('ğŸ”„ ìƒˆë¡œìš´ ì§„ë¡œ ì¶”ì²œ ìš”ì²­');
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                const recommendationLoading = document.getElementById('recommendationLoading');
                const recommendationResult = document.getElementById('recommendationResult');
                
                if (recommendationLoading) {
                    recommendationLoading.style.display = 'block';
                    recommendationLoading.querySelector('p').textContent = 'AIê°€ ë‹¤ë¥¸ ì§„ë¡œë¥¼ ì°¾ê³  ìˆì–´ìš”... ğŸ”âœ¨';
                }
                if (recommendationResult) {
                    recommendationResult.style.display = 'none';
                }
                
                // API í˜¸ì¶œ (ìƒˆë¡œìš´ ì¶”ì²œ ìš”ì²­)
                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/recommend`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        regenerate: true // ìƒˆë¡œìš´ ì¶”ì²œ ìš”ì²­ í”Œë˜ê·¸
                    })
                });
                
                const data = await response.json();
                console.log('ğŸ”„ ìƒˆë¡œìš´ AI ì¶”ì²œ ì‘ë‹µ:', data);
                
                if (data.success && data.data.career_recommendation) {
                    // 2ì´ˆ í›„ ìƒˆë¡œìš´ ì¶”ì²œ ê²°ê³¼ í‘œì‹œ
                    setTimeout(() => {
                        if (recommendationLoading) {
                            recommendationLoading.style.display = 'none';
                        }
                        if (recommendationResult) {
                            recommendationResult.style.display = 'block';
                        }
                        
                        const careerRecommendation = document.getElementById('careerRecommendation');
                        if (careerRecommendation) {
                            careerRecommendation.innerHTML = data.data.career_recommendation;
                        }
                        
                        // ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‹¤ì‹œ ì¶”ê°€
                        const acceptButton = document.getElementById('acceptRecommendation');
                        const modifyButton = document.getElementById('modifyRecommendation');
                        
                        if (acceptButton) {
                            acceptButton.onclick = () => acceptCareerRecommendation();
                        }
                        
                        if (modifyButton) {
                            modifyButton.onclick = () => requestNewRecommendation();
                        }
                    }, 2000);
                } else {
                    showError('ìƒˆë¡œìš´ ì§„ë¡œ ì¶”ì²œì„ ë°›ì•„ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    // ì—ëŸ¬ ì‹œ ì›ë˜ í™”ë©´ìœ¼ë¡œ ë³µêµ¬
                    if (recommendationLoading) {
                        recommendationLoading.style.display = 'none';
                    }
                    if (recommendationResult) {
                        recommendationResult.style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('âŒ ìƒˆë¡œìš´ ì¶”ì²œ ìš”ì²­ ì˜¤ë¥˜:', error);
                showError('ìƒˆë¡œìš´ ì§„ë¡œ ì¶”ì²œ ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                // ì—ëŸ¬ ì‹œ ì›ë˜ í™”ë©´ìœ¼ë¡œ ë³µêµ¬
                const recommendationLoading = document.getElementById('recommendationLoading');
                const recommendationResult = document.getElementById('recommendationResult');
                if (recommendationLoading) {
                    recommendationLoading.style.display = 'none';
                }
                if (recommendationResult) {
                    recommendationResult.style.display = 'block';
                }
            }
        }
        
        // ì§„ë¡œ ì¶”ì²œ ìˆ˜ë½ í•¨ìˆ˜
        async function acceptCareerRecommendation() {
            console.log('ğŸ‘ ì§„ë¡œ ì¶”ì²œ ìˆ˜ë½');
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/accept-recommendation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                console.log('ğŸ‘ ì¶”ì²œ ìˆ˜ë½ ì‘ë‹µ:', data);
                
                if (data.success) {
                    // ì™„ë£Œ í™”ë©´ìœ¼ë¡œ ì´ë™
                    showScreen('completionScreen');
                    updateProgress(5, true);
                    
                    // ì™„ë£Œ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                    const completionTitle = document.getElementById('completionTitle');
                    const completionMessage = document.getElementById('completionMessage');
                    const finalCareer = document.getElementById('finalCareer');
                    
                    if (completionTitle && studentInfo) {
                        completionTitle.textContent = `ì¶•í•˜í•©ë‹ˆë‹¤, ${studentInfo.name}ë‹˜! ğŸ‰`;
                    }
                    
                    if (completionMessage) {
                        completionMessage.textContent = 'ì§„ë¡œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ë“œë¦¼ë¡œì§ì„ ìƒì„±í•  ì¤€ë¹„ê°€ ë˜ì—ˆì–´ìš”!';
                    }
                    
                    if (finalCareer) {
                        const careerText = document.getElementById('careerRecommendation')?.textContent || 'ì„ íƒí•œ ì§„ë¡œ';
                        finalCareer.innerHTML = `
                            <div class="final-career-card">
                                <h3>ğŸ¯ í™•ì •ëœ ì§„ë¡œ</h3>
                                <p>${careerText}</p>
                            </div>
                        `;
                    }
                    
                    // ë“œë¦¼ë¡œì§ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
                    const generateDreamLogicBtn = document.getElementById('generateDreamLogic');
                    const restartJourneyBtn = document.getElementById('restartJourney');
                    
                    if (generateDreamLogicBtn) {
                        generateDreamLogicBtn.onclick = () => generateDreamLogic();
                    }
                    
                    if (restartJourneyBtn) {
                        restartJourneyBtn.onclick = () => restartCareerJourney();
                    }
                } else {
                    showError('ì§„ë¡œ ì¶”ì²œ ìˆ˜ë½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ ì¶”ì²œ ìˆ˜ë½ ì˜¤ë¥˜:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ë“œë¦¼ë¡œì§ ìƒì„± í•¨ìˆ˜
        async function generateDreamLogic() {
            console.log('ğŸŒˆ ë“œë¦¼ë¡œì§ ìƒì„± ìš”ì²­ ì‹œì‘');
            console.log('í˜„ì¬ ì„¸ì…˜ ID:', sessionId);
            console.log('í•™ìƒ ì •ë³´:', studentInfo);
            
            try {
                // ë“œë¦¼ë¡œì§ í™”ë©´ìœ¼ë¡œ ì „í™˜
                showScreen('dreamLogicScreen');
                
                // ë¡œë”© í‘œì‹œ
                const dreamLogicLoading = document.getElementById('dreamLogicLoading');
                const dreamLogicResult = document.getElementById('dreamLogicResult');
                
                console.log('ë¡œë”© ì—˜ë¦¬ë¨¼íŠ¸:', dreamLogicLoading);
                console.log('ê²°ê³¼ ì—˜ë¦¬ë¨¼íŠ¸:', dreamLogicResult);
                
                if (dreamLogicLoading) {
                    dreamLogicLoading.style.display = 'block';
                }
                if (dreamLogicResult) {
                    dreamLogicResult.style.display = 'none';
                }
                
                // API í˜¸ì¶œ
                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/dream-logic`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                console.log('ğŸŒˆ ë“œë¦¼ë¡œì§ ì‘ë‹µ ì „ì²´:', data);
                console.log('ë“œë¦¼ë¡œì§ ë‚´ìš©:', data.data?.dream_logic);
                console.log('ì‘ë‹µ ì„±ê³µ ì—¬ë¶€:', data.success);
                
                if (data.success && data.data && data.data.dream_logic) {
                    // 3ì´ˆ í›„ ë“œë¦¼ë¡œì§ ê²°ê³¼ í‘œì‹œ
                    setTimeout(() => {
                        if (dreamLogicLoading) {
                            dreamLogicLoading.style.display = 'none';
                        }
                        if (dreamLogicResult) {
                            dreamLogicResult.style.display = 'block';
                        }
                        
                        const dreamSteps = document.getElementById('dreamSteps');
                        if (dreamSteps) {
                            // ë“œë¦¼ë¡œì§ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ
                            const formattedContent = formatDreamLogic(data.data.dream_logic);
                            dreamSteps.innerHTML = formattedContent;
                        }
                        
                        // formatDreamLogic í•¨ìˆ˜ì—ì„œ ìë™ìœ¼ë¡œ ì‘ì›ë©”ëª¨ê°€ í‘œì‹œë¨
                        
                        // ì™„ë£Œ ë²„íŠ¼ í‘œì‹œ
                        const finishJourneyBtn = document.getElementById('finishJourney');
                        if (finishJourneyBtn) {
                            finishJourneyBtn.style.display = 'block';
                            finishJourneyBtn.onclick = () => finishJourney();
                        }
                        
                        // PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
                        const downloadPdfBtn = document.getElementById('downloadPdf');
                        if (downloadPdfBtn) {
                            downloadPdfBtn.onclick = () => downloadDreamLogicPdf();
                        }
                        
                        // ë“œë¦¼ë¡œì§ ì•¡ì…˜ ë²„íŠ¼ë“¤ í‘œì‹œ ë° ì´ë²¤íŠ¸ ì¶”ê°€
                        const dreamLogicActions = document.getElementById('dreamLogicActions');
                        if (dreamLogicActions) {
                            dreamLogicActions.style.display = 'block';
                            
                            // ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
                            const downloadDreamLogicPDFBtn = document.getElementById('downloadDreamLogicPDF');
                            if (downloadDreamLogicPDFBtn) {
                                downloadDreamLogicPDFBtn.onclick = () => downloadDreamLogicPDF();
                            }
                        }
                    }, 3000);
                } else {
                    console.error('ë“œë¦¼ë¡œì§ ì‘ë‹µ ì˜¤ë¥˜:', data);
                    
                    // ì„ì‹œë¡œ ë”ë¯¸ ë°ì´í„° í‘œì‹œ (ë””ë²„ê¹…ìš©)
                    const dummyDreamLogic = `[${studentInfo?.name || 'í•™ìƒ'}ì˜ ë“œë¦¼ ë¡œì§]
ìµœì¢…ê¿ˆ: í™˜ê²½ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¹œí™˜ê²½ ë¡œë´‡ ì—”ì§€ë‹ˆì–´

[ì¤‘ê°„ëª©í‘œ1] ë©”ì´í‚¹Â·ì„¤ê³„ ì—­ëŸ‰ í‚¤ìš°ê¸°
â€¢ ì‹¤ì²œí™œë™1: í•™êµìƒí™œ - ê³¼í•™ ì‹œê°„ì— ì¬í™œìš© ì†Œì¬ë¡œ ì›€ì§ì´ëŠ” ì¥ë‚œê° ë§Œë“¤ê¸°
â€¢ ì‹¤ì²œí™œë™2: ê°œì¸ ì„±ì¥ - ë ˆê³ ë¡œ ê¸°ê³„ êµ¬ì¡° ë”°ë¼ ë§Œë“¤ê³  ê¸°ë¡í•˜ê¸°

ì‘ì› ë©”ëª¨: ${studentInfo?.name || 'ë‹¹ì‹ '}ì˜ ì°½ì˜ì ì¸ ìƒê°ê³¼ ëˆê¸°ê°€ ìˆë‹¤ë©´ ë¶„ëª… ë©‹ì§„ ê¿ˆì„ ì´ë£° ìˆ˜ ìˆì–´ìš”! ğŸ˜ŠğŸ’š`;
                    
                    setTimeout(() => {
                        if (dreamLogicLoading) {
                            dreamLogicLoading.style.display = 'none';
                        }
                        if (dreamLogicResult) {
                            dreamLogicResult.style.display = 'block';
                        }
                        
                        const dreamSteps = document.getElementById('dreamSteps');
                        if (dreamSteps) {
                            const formattedContent = formatDreamLogic(dummyDreamLogic);
                            dreamSteps.innerHTML = formattedContent;
                        }
                        
                        // formatDreamLogic í•¨ìˆ˜ì—ì„œ ìë™ìœ¼ë¡œ ì‘ì›ë©”ëª¨ê°€ í‘œì‹œë¨
                        
                        const finishJourneyBtn = document.getElementById('finishJourney');
                        if (finishJourneyBtn) {
                            finishJourneyBtn.style.display = 'block';
                            finishJourneyBtn.onclick = () => finishJourney();
                        }
                    }, 3000);
                    
                    // showError('ë“œë¦¼ë¡œì§ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    // showScreen('completionScreen'); // ì›ë˜ í™”ë©´ìœ¼ë¡œ ë³µêµ¬
                }
            } catch (error) {
                console.error('âŒ ë“œë¦¼ë¡œì§ ìƒì„± ì˜¤ë¥˜:', error);
                showError('ë“œë¦¼ë¡œì§ ìƒì„± ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                showScreen('completionScreen'); // ì›ë˜ í™”ë©´ìœ¼ë¡œ ë³µêµ¬
            }
        }
        
        // ë“œë¦¼ë¡œì§ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ í¬ë§·íŒ…
        function formatDreamLogic(dreamLogicText) {
            console.log('ğŸ¨ ë“œë¦¼ë¡œì§ í¬ë§·íŒ… ì‹œì‘:', dreamLogicText);
            console.log('ğŸ” ì‘ì›ë©”ëª¨ ê²€ìƒ‰ ì¤‘...');
            
            let formatted = '<div class="dream-logic-content">';
            const lines = dreamLogicText.split('\n');
            let currentSection = '';
            let inSchoolActivity = false;
            let inPersonalActivity = false;
            let foundEncouragement = false;
            let collectingEncouragement = false; // ì‘ì›ë©”ëª¨ ìˆ˜ì§‘ ì¤‘ì¸ì§€ í”Œë˜ê·¸
            let encouragementLines = []; // ì‘ì›ë©”ëª¨ ë¼ì¸ë“¤ ìˆ˜ì§‘
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                console.log('ì²˜ë¦¬ ì¤‘ì¸ ë¼ì¸:', line);
                
                // ì‘ì› ë©”ëª¨ ì‹œì‘ ê°ì§€
                if (line.includes('ì‘ì›') && (line.includes('ë©”ëª¨') || line.includes('ë©”ì‹œì§€') || line.includes(':'))) {
                    console.log('ğŸ¯ ì‘ì›ë©”ëª¨ ì‹œì‘ ë¼ì¸ ë°œê²¬:', line);
                    
                    if (inSchoolActivity || inPersonalActivity) {
                        formatted += '</ul></div>'; // í™œë™ ì»¨í…Œì´ë„ˆ ë‹«ê¸°
                        inSchoolActivity = false;
                        inPersonalActivity = false;
                    }
                    
                    collectingEncouragement = true;
                    foundEncouragement = true;
                    
                    // ì²« ë¼ì¸ì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œë„
                    const patterns = [
                        /ì‘ì›\s*ë©”ëª¨\s*[:ï¼š]\s*/i,
                        /ì‘ì›ë©”ëª¨\s*[:ï¼š]\s*/i,
                        /ì‘ì›\s*ë©”ì‹œì§€\s*[:ï¼š]\s*/i,
                        /ì‘ì›ë©”ì‹œì§€\s*[:ï¼š]\s*/i
                    ];
                    
                    let firstLineText = line;
                    for (const pattern of patterns) {
                        if (pattern.test(line)) {
                            firstLineText = line.replace(pattern, '').trim();
                            break;
                        }
                    }
                    
                    if (firstLineText) {
                        encouragementLines.push(firstLineText);
                    }
                    
                    continue; // ì‘ì›ë©”ëª¨ ì²˜ë¦¬ëŠ” ë³„ë„ë¡œ í•˜ë¯€ë¡œ ë‹¤ë¥¸ ì²˜ë¦¬ ê±´ë„ˆë›°ê¸°
                }
                
                // ì‘ì›ë©”ëª¨ ìˆ˜ì§‘ ì¤‘ì´ë©´ ë‹¤ìŒ ë¼ì¸ë“¤ë„ ì‘ì›ë©”ëª¨ë¡œ ìˆ˜ì§‘
                if (collectingEncouragement) {
                    // ìƒˆë¡œìš´ ì„¹ì…˜ì´ ì‹œì‘ë˜ë©´ ì‘ì›ë©”ëª¨ ìˆ˜ì§‘ ì¢…ë£Œ
                    if (line.match(/^\[.+\]$/) || line.startsWith('ìµœì¢…ê¿ˆ:') || line.startsWith('ì¤‘ê°„ëª©í‘œ')) {
                        collectingEncouragement = false;
                        console.log('ï¿½ ì‘ì›ë©”ëª¨ ìˆ˜ì§‘ ì¢…ë£Œ - ìƒˆ ì„¹ì…˜ ì‹œì‘');
                    } else {
                        encouragementLines.push(line);
                        console.log('ğŸ“ ì‘ì›ë©”ëª¨ ë¼ì¸ ìˆ˜ì§‘:', line);
                        continue; // ë‹¤ë¥¸ ì²˜ë¦¬ ê±´ë„ˆë›°ê¸°
                    }
                }
                
                // ë‚˜ë¨¸ì§€ ë“œë¦¼ë¡œì§ ì²˜ë¦¬ (ê¸°ì¡´ ë¡œì§ê³¼ ë™ì¼)
                // ë“œë¦¼ë¡œì§ ì œëª© (ëŒ€ê´„í˜¸)
                if (line.match(/^\[.+\]$/)) {
                    formatted += `<h3>${line}</h3>`;
                }
                // ìµœì¢…ê¿ˆ
                else if (line.startsWith('ìµœì¢…ê¿ˆ:')) {
                    const dream = line.replace('ìµœì¢…ê¿ˆ:', '').trim();
                    formatted += `<div class="final-dream"><strong>ğŸŒŸ ìµœì¢…ê¿ˆ:</strong> ${dream}</div>`;
                }
                // ì¤‘ê°„ëª©í‘œ (ëŒ€ê´„í˜¸ë¡œ ì‹œì‘)
                else if (line.match(/^\[ì¤‘ê°„ëª©í‘œ\d+\]/)) {
                    if (inSchoolActivity || inPersonalActivity) {
                        formatted += '</div>'; // ì´ì „ í™œë™ ì»¨í…Œì´ë„ˆ ë‹«ê¸°
                        inSchoolActivity = false;
                        inPersonalActivity = false;
                    }
                    formatted += `<h4>${line}</h4>`;
                    currentSection = 'goal';
                }
                // ì‹¤ì²œí™œë™1 (í•™êµìƒí™œ)
                else if (line.includes('ì‹¤ì²œí™œë™1') && (line.includes('í•™êµìƒí™œ') || line.includes('í•™êµ'))) {
                    if (inPersonalActivity) {
                        formatted += '</div>'; // ê°œì¸ì„±ì¥ ì»¨í…Œì´ë„ˆ ë‹«ê¸°
                        inPersonalActivity = false;
                    }
                    formatted += `<h5>ì‹¤ì²œí™œë™1: í•™êµìƒí™œ</h5>`;
                    formatted += '<div class="activity-container"><ul>';
                    inSchoolActivity = true;
                    currentSection = 'school';
                }
                // ì‹¤ì²œí™œë™2 (ê°œì¸ì„±ì¥)
                else if (line.includes('ì‹¤ì²œí™œë™2') && (line.includes('ê°œì¸') || line.includes('ì„±ì¥'))) {
                    if (inSchoolActivity) {
                        formatted += '</ul></div>'; // í•™êµìƒí™œ ì»¨í…Œì´ë„ˆ ë‹«ê¸°
                        inSchoolActivity = false;
                    }
                    formatted += `<h5>ì‹¤ì²œí™œë™2: ê°œì¸ì„±ì¥</h5>`;
                    formatted += '<div class="activity-container"><ul>';
                    inPersonalActivity = true;
                    currentSection = 'personal';
                }
                // ë²ˆí˜¸ê°€ ìˆëŠ” í™œë™ ë¦¬ìŠ¤íŠ¸ (1., 2. ë“±)
                else if (line.match(/^\d+\.\s/)) {
                    if (currentSection === 'school') {
                        formatted += `<li class="school-activity">${line}</li>`;
                    } else if (currentSection === 'personal') {
                        formatted += `<li class="personal-activity">${line}</li>`;
                    } else {
                        formatted += `<li>${line}</li>`;
                    }
                }
                // ì‘ì› ë©”ëª¨ëŠ” ìœ„ì˜ ìƒˆë¡œìš´ ë¡œì§ì—ì„œ ì²˜ë¦¬ë¨
                // ê¸°íƒ€ í…ìŠ¤íŠ¸
                else if (line.length > 0) {
                    // ì¤‘ê°„ëª©í‘œ ì„¤ëª…ì´ë‚˜ ê¸°íƒ€ ë‚´ìš©
                    if (currentSection === 'goal' && !line.startsWith('â€¢')) {
                        formatted += `<p style="margin-left: 15px; color: #666; font-style: italic;">${line}</p>`;
                    }
                }
            }
            
            // ë§ˆì§€ë§‰ì— ì—´ë¦° ì»¨í…Œì´ë„ˆë“¤ ë‹«ê¸°
            if (inSchoolActivity || inPersonalActivity) {
                formatted += '</ul></div>';
            }
            
            formatted += '</div>';
            
            // ìˆ˜ì§‘ëœ ì‘ì›ë©”ëª¨ ë¼ì¸ë“¤ì„ í•©ì³ì„œ ì €ì¥
            if (foundEncouragement && encouragementLines.length > 0) {
                encouragementMessage = encouragementLines.join(' ').trim();
                console.log('ğŸ’ ìµœì¢… ì‘ì›ë©”ëª¨ ì¡°í•© ì™„ë£Œ:', encouragementMessage);
            }
            
            // ì‘ì›ë©”ëª¨ ë°œê²¬ ì—¬ë¶€ í™•ì¸
            console.log('ğŸ” ì‘ì›ë©”ëª¨ ë°œê²¬ ì—¬ë¶€:', foundEncouragement);
            console.log('ğŸ’ ìµœì¢… ì €ì¥ëœ ì‘ì›ë©”ëª¨:', encouragementMessage);
            console.log('ğŸ¨ í¬ë§·íŒ… ì™„ë£Œ:', formatted);
            
            // ì‘ì›ë©”ëª¨ê°€ ì¶”ì¶œë˜ì—ˆìœ¼ë©´ ì¦‰ì‹œ ë“œë¦¼ë¡œì§ í™”ë©´ì— í‘œì‹œ
            if (foundEncouragement && encouragementMessage) {
                setTimeout(() => {
                    showEncouragementInDreamLogic();
                }, 100);
            }
            
            return formatted;
        }
        
        // PDF ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadDreamLogicPdf() {
            console.log('ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ ìš”ì²­');
            
            try {
                const response = await fetch(`${API_BASE_URL}/career/${sessionId}/download-pdf`, {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${studentInfo.name}_ë“œë¦¼ë¡œì§.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                } else {
                    showError('PDF ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ PDF ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                showError('PDF ë‹¤ìš´ë¡œë“œ ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë“œë¦¼ë¡œì§ í™”ë©´ì— ì‘ì›ë©”ëª¨ í‘œì‹œí•˜ëŠ” ì „ìš© í•¨ìˆ˜
        function showEncouragementInDreamLogic() {
            console.log('ğŸ¯ showEncouragementInDreamLogic í˜¸ì¶œë¨');
            console.log('ğŸ’ í‘œì‹œí•  ì‘ì›ë©”ì‹œì§€:', encouragementMessage);
            
            const encouragementDiv = document.getElementById('encouragementMessage');
            console.log('ğŸ” encouragementMessage ìš”ì†Œ:', encouragementDiv);
            
            if (encouragementDiv && encouragementMessage && encouragementMessage.trim() !== '') {
                encouragementDiv.innerHTML = `
                    <div class="encouragement-card">
                        <h3>ğŸ’ ë“œë¦¼ë¡œì§ì´ ë³´ë‚´ëŠ” íŠ¹ë³„í•œ ì‘ì› ë©”ì‹œì§€</h3>
                        <p>${encouragementMessage}</p>
                    </div>
                `;
                encouragementDiv.style.display = 'block';
                console.log('âœ… ì‘ì›ë©”ëª¨ í‘œì‹œ ì™„ë£Œ!');
            } else {
                console.log('âŒ ì‘ì›ë©”ëª¨ í‘œì‹œ ì‹¤íŒ¨ - ìš”ì†Œë‚˜ ë©”ì‹œì§€ê°€ ì—†ìŒ');
                console.log('  - encouragementDiv:', !!encouragementDiv);
                console.log('  - encouragementMessage:', encouragementMessage);
            }
        }
        
        // ì—¬ì • ì¬ì‹œì‘ í•¨ìˆ˜
        function restartCareerJourney() {
            console.log('ğŸ”„ ì§„ë¡œ íƒìƒ‰ ì¬ì‹œì‘');
            
            // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
            sessionId = null;
            studentInfo = null;
            currentQuestionData = null;
            selectedChoices = [];
            encouragementMessage = null; // ì‘ì›ë©”ëª¨ë„ ì´ˆê¸°í™”
            
            // ì‹œì‘ í™”ë©´ìœ¼ë¡œ ì´ë™
            showScreen('startScreen');
            updateProgress(0);
        }
        
        // í…ŒìŠ¤íŠ¸ìš© ì‘ì›ë©”ëª¨ í•¨ìˆ˜ (ì„ì‹œ)
        function testEncouragementMessage() {
            console.log('ğŸ§ª ì‘ì›ë©”ëª¨ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            // ì„ì‹œ í•™ìƒ ì •ë³´ ì„¤ì •
            studentInfo = { name: 'í…ŒìŠ¤íŠ¸í•™ìƒ', grade: 5 };
            
            // í…ŒìŠ¤íŠ¸ìš© ë“œë¦¼ë¡œì§ í…ìŠ¤íŠ¸
            const testDreamLogic = `[í…ŒìŠ¤íŠ¸í•™ìƒì˜ ë“œë¦¼ ë¡œì§]
ìµœì¢…ê¿ˆ: í™˜ê²½ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¹œí™˜ê²½ ë¡œë´‡ ì—”ì§€ë‹ˆì–´

[ì¤‘ê°„ëª©í‘œ1] ë©”ì´í‚¹Â·ì„¤ê³„ ì—­ëŸ‰ í‚¤ìš°ê¸°
â€¢ ì‹¤ì²œí™œë™1: í•™êµìƒí™œ - ê³¼í•™ ì‹œê°„ì— ì¬í™œìš© ì†Œì¬ë¡œ ì›€ì§ì´ëŠ” ì¥ë‚œê° ë§Œë“¤ê¸°
â€¢ ì‹¤ì²œí™œë™2: ê°œì¸ ì„±ì¥ - ë ˆê³ ë¡œ ê¸°ê³„ êµ¬ì¡° ë”°ë¼ ë§Œë“¤ê³  ê¸°ë¡í•˜ê¸°

ì‘ì› ë©”ëª¨: í…ŒìŠ¤íŠ¸í•™ìƒì˜ ì°½ì˜ì ì¸ ìƒê°ê³¼ ëˆê¸°ê°€ ìˆë‹¤ë©´ ë¶„ëª… ë©‹ì§„ ê¿ˆì„ ì´ë£° ìˆ˜ ìˆì–´ìš”! ğŸ˜ŠğŸ’š`;
            
            // 1. ë¨¼ì € ë“œë¦¼ë¡œì§ í™”ë©´ í‘œì‹œ
            showScreen('dreamLogicScreen');
            
            // 2. ë“œë¦¼ë¡œì§ ê²°ê³¼ í‘œì‹œ (ì‘ì›ë©”ëª¨ëŠ” ì¶”ì¶œë§Œ ë¨)
            setTimeout(() => {
                const dreamLogicLoading = document.getElementById('dreamLogicLoading');
                const dreamLogicResult = document.getElementById('dreamLogicResult');
                
                if (dreamLogicLoading) dreamLogicLoading.style.display = 'none';
                if (dreamLogicResult) dreamLogicResult.style.display = 'block';
                
                const dreamSteps = document.getElementById('dreamSteps');
                if (dreamSteps) {
                    const formattedContent = formatDreamLogic(testDreamLogic);
                    dreamSteps.innerHTML = formattedContent;
                }
                
                // formatDreamLogic í•¨ìˆ˜ì—ì„œ ìë™ìœ¼ë¡œ ì‘ì›ë©”ëª¨ê°€ í‘œì‹œë¨
                
                // 3. ì™„ë£Œ ë²„íŠ¼ í‘œì‹œ
                const finishJourneyBtn = document.getElementById('finishJourney');
                if (finishJourneyBtn) {
                    finishJourneyBtn.style.display = 'block';
                    finishJourneyBtn.onclick = () => finishJourney();
                }
            }, 1000);
        }
        
        // ê°„ë‹¨í•œ ì§ì ‘ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testEncouragementDirect() {
            console.log('ğŸ§ª ì§ì ‘ ì‘ì›ë©”ëª¨ í…ŒìŠ¤íŠ¸');
            
            // ì‘ì›ë©”ëª¨ ì§ì ‘ ì„¤ì •
            encouragementMessage = 'í…ŒìŠ¤íŠ¸ ì‘ì›ë©”ì‹œì§€ì…ë‹ˆë‹¤! í™”ì´íŒ…! ğŸ˜ŠğŸ’ª';
            
            // ë“œë¦¼ë¡œì§ í™”ë©´ìœ¼ë¡œ ì´ë™
            showScreen('dreamLogicScreen');
            
            setTimeout(() => {
                // ë¡œë”© ìˆ¨ê¸°ê³  ê²°ê³¼ í‘œì‹œ
                const dreamLogicLoading = document.getElementById('dreamLogicLoading');
                const dreamLogicResult = document.getElementById('dreamLogicResult');
                
                if (dreamLogicLoading) dreamLogicLoading.style.display = 'none';
                if (dreamLogicResult) dreamLogicResult.style.display = 'block';
                
                // ì‘ì›ë©”ëª¨ ì§ì ‘ í‘œì‹œ
                showEncouragementInDreamLogic();
                
                // ë²„íŠ¼ í‘œì‹œ
                const dreamLogicActions = document.getElementById('dreamLogicActions');
                if (dreamLogicActions) {
                    dreamLogicActions.style.display = 'block';
                }
            }, 500);
        }
        
        // ì§„ë¡œ íƒìƒ‰ ì™„ë£Œ í›„ í™ˆí˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
        function finishJourney() {
            console.log('ğŸ† ì§„ë¡œ íƒìƒ‰ ì™„ë£Œ - í™ˆí˜ì´ì§€ë¡œ ì´ë™');
            window.location.href = '/';
        }
        
        // ìµœì¢… ì™„ë£Œ í™”ë©´ í‘œì‹œ í•¨ìˆ˜ (ì‘ì›ë©”ëª¨ í¬í•¨)
        function showFinalCompletion() {
            console.log('ğŸ‰ ìµœì¢… ì™„ë£Œ í™”ë©´ í‘œì‹œ');
            console.log('ğŸ’ ì €ì¥ëœ ì‘ì›ë©”ëª¨:', encouragementMessage);
            
            // ì™„ë£Œ í™”ë©´ìœ¼ë¡œ ì´ë™
            showScreen('completionScreen');
            updateProgress(5, true);
            
            // ì™„ë£Œ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            const completionTitle = document.getElementById('completionTitle');
            const completionMessage = document.getElementById('completionMessage');
            
            if (completionTitle && studentInfo) {
                completionTitle.textContent = `ìˆ˜ê³ í–ˆì–´ìš”, ${studentInfo.name}ë‹˜! ğŸ‰`;
            }
            
            if (completionMessage) {
                completionMessage.textContent = 'ë“œë¦¼ë¡œì§ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ê¿ˆì„ í–¥í•œ ì²«ê±¸ìŒì„ ì‹œì‘í•´ë³´ì„¸ìš”!';
            }
            
            // ì‘ì›ë©”ëª¨ í‘œì‹œ ë¡œì§ ê°•í™”
            const finalEncouragement = document.getElementById('finalEncouragement');
            const finalEncouragementText = document.getElementById('finalEncouragementText');
            
            console.log('ğŸ” HTML ìš”ì†Œ í™•ì¸:', {
                finalEncouragement: !!finalEncouragement,
                finalEncouragementText: !!finalEncouragementText,
                encouragementMessage: encouragementMessage
            });
            
            if (finalEncouragement && finalEncouragementText) {
                let messageToShow = encouragementMessage;
                
                // ì‘ì›ë©”ëª¨ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©
                if (!messageToShow || messageToShow.trim() === '') {
                    messageToShow = `${studentInfo?.name || 'ì—¬ëŸ¬ë¶„'}ì˜ ì—´ì •ê³¼ ë…¸ë ¥ì´ ìˆë‹¤ë©´ ë¶„ëª… ë©‹ì§„ ê¿ˆì„ ì´ë£° ìˆ˜ ìˆì„ ê±°ì˜ˆìš”! ğŸ˜ŠğŸ’ª`;
                    console.log('ğŸ“ ê¸°ë³¸ ì‘ì›ë©”ì‹œì§€ ì‚¬ìš©:', messageToShow);
                }
                
                finalEncouragementText.textContent = messageToShow;
                finalEncouragement.style.display = 'block';
                
                console.log('âœ… ì‘ì›ë©”ëª¨ ì„¤ì • ì™„ë£Œ');
                
                // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
                setTimeout(() => {
                    finalEncouragement.classList.add('show');
                    console.log('ğŸ­ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€ë¨');
                }, 500);
            } else {
                console.error('âŒ ì‘ì›ë©”ëª¨ HTML ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
            const restartJourneyBtn = document.getElementById('restartJourney');
            if (restartJourneyBtn) {
                restartJourneyBtn.onclick = () => restartCareerJourney();
            }
        }
        
        // ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadDreamLogicPDF() {
            console.log('ğŸ”® ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ì‹œì‘');
            
            if (!studentInfo || !sessionId) {
                showError('í•™ìƒ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                showLoading(true);
                
                // ì„¸ì…˜ ë°ì´í„° ì¡°íšŒ
                const sessionResponse = await fetch(`${API_BASE_URL}/career/${sessionId}/data`);
                const sessionData = await sessionResponse.json();
                
                if (!sessionData.success) {
                    throw new Error('ì„¸ì…˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const responses = sessionData.data.responses;
                const finalRecommendation = sessionData.data.final_recommendation || 'ì§„ë¡œ ì¶”ì²œ ì •ë³´ ì—†ìŒ';
                
                // ë“œë¦¼ë¡œì§ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸° (í˜„ì¬ í™”ë©´ì—ì„œ)
                const dreamLogicElement = document.getElementById('dreamSteps');
                const dreamLogicResult = dreamLogicElement ? dreamLogicElement.innerText : '';
                
                // PDF ë‹¤ìš´ë¡œë“œ ìš”ì²­
                const pdfResponse = await fetch(`${API_BASE_URL}/career/download-pdf`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        student_name: studentInfo.name,
                        responses: responses,
                        final_recommendation: finalRecommendation,
                        dream_logic_result: dreamLogicResult,
                        encouragement_message: encouragementMessage || '' // ì‘ì›ë©”ì‹œì§€ ì¶”ê°€
                    })
                });
                
                if (!pdfResponse.ok) {
                    throw new Error('PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                // PDF íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const blob = await pdfResponse.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                
                // íŒŒì¼ëª… ì„¤ì •
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[-:]/g, '').replace('T', '_');
                a.download = `${studentInfo.name}_ë“œë¦¼ë¡œì§_ì§„ë¡œíƒìƒ‰ê²°ê³¼_${timestamp}.pdf`;
                
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                console.log('âœ… ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                showError(`ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // ì˜¤ë¥˜ í‘œì‹œ í•¨ìˆ˜
        function showError(message) {
            console.error('âŒ ì˜¤ë¥˜:', message);
            alert(`âŒ ${message}`);
        }
        
        // ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            // ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
            const dreamLogicPdfBtn = document.getElementById('downloadDreamLogicPDF');
            if (dreamLogicPdfBtn) {
                dreamLogicPdfBtn.onclick = downloadDreamLogicPDF;
                console.log('âœ… ë“œë¦¼ë¡œì§ PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ');
            }
        });
        
        console.log('ğŸš€ ì¸ë¼ì¸ JavaScript ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>